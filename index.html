<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    </style>
</head>
<body>
    <div id="canvas"></div>




    <script src="d3.v5.7.0.js"></script>

    <script>
        const svg = d3.select('#canvas')
            .append('svg')
            .attr('width', 600)
            .attr('height', 600)
            .attr('style', 'background-color: #ccc');

        let margin = {top: 40, left: 100, right: 40, bottom: 100};
        let graphWidth = 600 - margin.left - margin.right,
            graphHeight = 600 - margin.top - margin.bottom;

        let graph = svg.append('g')
            .attr('width', graphWidth)
            .attr('height', graphHeight)
            .attr('transform', `translate(${margin.left}, ${margin.top})`);

        // group for x-axis
        let xAxisGroup = graph.append("g")
            .attr('transform', `translate(0, ${graphHeight})`);

        // group for y-axis
        let yAxisGroup = graph.append("g");

        // creating x scale
        x = d3.scaleBand()
            .range([0, graphWidth])
            .padding(0.2);

        // creating y scale
        y = d3.scaleLinear()
            .range([graphHeight, 0]);

        d3.json('./data/complaintTypes.json')
            .then(data => {
                console.log(data);

                x.domain(data.map(d => d.type));
                y.domain([0, d3.max(data, d => d.number)]);

                xAxisGroup.call(d3.axisBottom(x));
                yAxisGroup.call(d3.axisLeft(y));

                const rects = graph.selectAll('rect')
                    .data(data)
                    .enter()
                    .append('rect')
                    .attr('x', d => x(d.type))
                    .attr('y', graphHeight)
                    .on('mouseover', mouseOver)
                    .on('mouseout', mouseOut)
                    .transition()
                    .duration(500)
                    .attr('y', d => {
                        return y(d.number)
                    })
                    .attr('width', x.bandwidth())
                    .attr('height', d =>  graphHeight - y(d.number))
                    .attr('fill', 'orange');

                function mouseOver(d, i, n) {
                    d3.select(this)
                        .transition()
                        .duration(500)
                        .attr('fill', 'blue')


                    graph.append('text')
                        .attr('class', 'value')
                        .attr('fill', '#000')
                        .attr('font-size', '14px')
                        .text(d.number)
                        .attr('x', () => x(d.type) + 10)
                        .attr('y', () => y(d.number) - 15);

                    
                }

                function mouseOut(d, i, n) {
                    d3.select(this)
                        .transition()
                        .duration(500)
                        .attr('fill', 'orange')

                    d3.select('.value').remove();
                }

            })


        
    </script>
</body>
</html>