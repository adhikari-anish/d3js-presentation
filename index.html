<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #canvas {
            width: 500px;
            height: 500px;
        }
    </style>
</head>
<body>
    <div id="canvas"></div>




    <script src="d3.v5.7.0.js"></script>
    <!-- d3 legend -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js" integrity="sha512-wNH6xsp2n8CfB91nrBtfc4sfLwYPBMjSWVUwQOp60AYYXH6i8yCwuKFZ4rgK2i6pQek/b+bSyR7b01/922IBzQ==" crossorigin="anonymous"></script>
    <!-- d3-tip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js" integrity="sha512-a+/SD0dbGeXTN4AA5F1dDZqsPvXKKyS1bvU2z5ElpKNJ4xQlOMUs/1+suA+j+kj5nAAya+VmT5HUKZmazluxVQ==" crossorigin="anonymous"></script>

    <script>
        
        const dims = { width: 380, height: 310 };
        const radius = Math.min(dims.width, dims.height) / 2;
        const svg = d3.select('#canvas')
                        .append('svg')
                        .attr('viewBox', `0 0 480 410`);

        const graph = svg.append('g')
                    .attr('transform', `translate(${(dims.width + 100)/2}, ${(dims.height + 100)/2})`);

        const color = d3.scaleOrdinal(['#4cc02a', '#9a73ed', '#ecc026']);

        const pie = d3.pie()
                        .value(d => d.number);

        console.log(pie)

        const arcPath = d3.arc()
                            .outerRadius(radius)
                            .innerRadius(0);

        const legendGroup = svg.append('g')
                                .attr('transform', `translate(${(dims.width + 100)/2 - 54}, ${(dims.height + 60)})`);

        const legend = d3.legendColor()
                            .orient('horizontal')
                            .shape('rect')
                            .shapePadding(50)
                            .scale(color);

        const tip = d3.tip()
                        .attr('class', 'pie-chart-tip')
                        .html(d => {
                            let content = `<div>${d.data.status} - ${d.data.number}</div>`;
                            return content;
                        });

        graph.call(tip);


        d3.json("/data/complaintStatus.json")
            .then(data => {
                color.domain(data.map(d => d.status));

                const paths = graph.selectAll('path')
                                .data(pie(data));

                // console.log(pie(data));
                
                paths.enter()
                    .append('path')
                    .attr('class', 'arc')
                    // .attr('stroke', '#fff')
                    // .attr('strokeWidth', 3)
                    .attr('fill', d => color(d.data.status))
                    .attr("d", arcPath);


                // update and call legend
                legendGroup.call(legend);
                legendGroup.selectAll('text').attr('fill', '#2a3539')

                // graph title
                svg.append('text')
                .attr('transform', `translate(${(dims.width+100)/2}, 35)`)
                .attr('font-size', '18px')
                .attr('fill', '#2a3539')
                .attr('text-anchor', 'middle')
                .text('Complaint Status');

                // add events
                graph.selectAll('path')
                    .on('mouseover', function(d, i, n) {
                        tip.show(d, n[i]);
                    })
                    .on('mouseout', function(d, i, n) {
                        tip.hide();
                    })
            })



        
    </script>
</body>
</html>